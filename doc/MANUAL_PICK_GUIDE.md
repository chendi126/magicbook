# 🎨 手动取色功能使用指南

## 功能概述

手动取色功能让你可以精确选择图片中任意位置的颜色，不再受限于自动提取算法，完全由你掌控配色方案。

---

## ✨ 功能特性

### 1. 双模式取色 🔄
- **自动提取** - 使用中位切分算法自动提取主要颜色
- **手动取色** - 点击图片任意位置选择颜色
- **一键切换** - 随时在两种模式间切换

### 2. 点击取色 👆
- **精确取色** - 点击图片任意位置获取该点颜色
- **实时反馈** - 立即显示选中的颜色
- **Toast 提示** - 显示添加的颜色值

### 3. 多点取色 🎯
- **最多 8 个** - 支持选择最多 8 个颜色
- **数量提示** - 显示已选择/最大数量
- **限制提示** - 达到上限时提示用户

### 4. 颜色管理 📋
- **查看列表** - 显示所有已选择的颜色
- **删除单个** - 删除不需要的颜色
- **清空全部** - 一键清空所有颜色
- **配色预览** - 实时预览配色效果

### 5. 保存方案 💾
- **支持保存** - 手动选择的颜色可以保存为配色方案
- **添加标签** - 为方案添加标签
- **自动跳转** - 保存后自动跳转到配色库

---

## 📱 使用步骤

### 步骤 1: 选择图片

1. **打开应用** - 进入"提取"页面
2. **点击"选择图片"** - 从相册选择一张图片
3. **图片加载** - 等待图片加载完成

---

### 步骤 2: 切换到手动取色模式

1. **找到模式切换** - 图片下方有"取色模式"选项
2. **点击"手动取色"** - 切换到手动取色模式
3. **查看提示** - 图片上方显示"点击图片取色"

```
┌─────────────────────────────────┐
│ 取色模式: [○ 自动提取] [● 手动取色] │
└─────────────────────────────────┘
```

---

### 步骤 3: 点击图片选择颜色

1. **点击图片** - 点击你想要的颜色位置
2. **查看反馈** - Toast 提示"已添加颜色 #XXXXXX"
3. **查看列表** - 颜色自动添加到下方列表
4. **继续选择** - 重复点击选择更多颜色（最多 8 个）

**示例**：
- 点击天空 → 添加蓝色
- 点击草地 → 添加绿色
- 点击花朵 → 添加粉色

---

### 步骤 4: 管理颜色

#### **删除单个颜色**
1. 在颜色列表中找到要删除的颜色
2. 点击右侧的"删除"按钮
3. 颜色从列表中移除

#### **清空所有颜色**
1. 点击右上角的"清空"按钮
2. 确认对话框中点击"清空"
3. 所有颜色被清空

---

### 步骤 5: 保存配色方案

1. **点击"保存配色方案"** - 底部按钮
2. **输入方案名称** - 如"夏日海滩"
3. **选择标签**（可选）- 添加标签分类
4. **点击"保存"** - 保存到配色库
5. **自动跳转** - 跳转到配色库查看

---

## 🎨 UI 说明

### 主页布局（手动取色模式）

```
┌─────────────────────────────────┐
│ 色彩提取                        │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ │      [图片预览]             │ │
│ │   点击图片取色 ←提示        │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│ [重新选择]                      │
├─────────────────────────────────┤
│ 取色模式:                       │
│ [○ 自动提取] [● 手动取色]      │
├─────────────────────────────────┤
│ 已选择颜色          3/8  [清空]│
│ ┌───────────────────────────┐   │
│ │ ███ ███ ███              │   │
│ └───────────────────────────┘   │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ ■ #FF5733                   │ │
│ │   rgb(255, 87, 51)   [删除]│ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ ■ #33FF57                   │ │
│ │   rgb(51, 255, 87)   [删除]│ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ ■ #5733FF                   │ │
│ │   rgb(87, 51, 255)   [删除]│ │
│ └─────────────────────────────┘ │
├─────────────────────────────────┤
│ [保存配色方案]                  │
└─────────────────────────────────┘
```

### 空状态提示

```
┌─────────────────────────────────┐
│ 已选择颜色          0/8         │
│                                 │
│         👆                      │
│     点击图片选择颜色            │
│                                 │
└─────────────────────────────────┘
```

---

## 🧪 测试场景

### 场景 1: 基础取色
1. 选择一张风景图片
2. 切换到"手动取色"模式
3. 点击天空位置
4. **验证**: 添加蓝色到列表 ✅
5. **验证**: Toast 提示"已添加颜色 #XXXXXX" ✅

### 场景 2: 多点取色
1. 继续点击图片不同位置
2. 选择 5 个不同颜色
3. **验证**: 列表显示 5 个颜色 ✅
4. **验证**: 显示"5/8" ✅
5. **验证**: 配色预览条显示 5 个颜色 ✅

### 场景 3: 达到上限
1. 继续选择颜色直到 8 个
2. 再次点击图片
3. **验证**: Toast 提示"最多选择8个颜色" ✅
4. **验证**: 不再添加新颜色 ✅

### 场景 4: 删除颜色
1. 点击某个颜色的"删除"按钮
2. **验证**: 颜色从列表移除 ✅
3. **验证**: 配色预览条更新 ✅
4. **验证**: 数量变为"4/8" ✅

### 场景 5: 清空颜色
1. 点击"清空"按钮
2. 确认对话框点击"清空"
3. **验证**: 所有颜色被清空 ✅
4. **验证**: 显示空状态提示 ✅

### 场景 6: 模式切换
1. 手动取色模式下选择 3 个颜色
2. 切换到"自动提取"模式
3. **验证**: 手动颜色被清空 ✅
4. **验证**: 自动提取颜色显示 ✅
5. 切换回"手动取色"模式
6. **验证**: 自动颜色被清空 ✅

### 场景 7: 保存方案
1. 手动选择 5 个颜色
2. 点击"保存配色方案"
3. 输入名称"手动配色"
4. 点击"保存"
5. **验证**: 保存成功 ✅
6. **验证**: 跳转到配色库 ✅
7. **验证**: 配色库显示新方案 ✅

---

## 💡 使用技巧

### 精确取色
- **放大图片** - 选择前可以先放大图片（如果支持）
- **多次尝试** - 不满意可以删除重新选择
- **对比查看** - 使用配色预览条对比效果

### 高效选择
1. **先选主色** - 先选择图片中的主要颜色
2. **再选辅色** - 然后选择辅助颜色
3. **最后调整** - 删除不满意的颜色

### 应用场景
- 🎨 **品牌色提取** - 从 Logo 中精确提取品牌色
- 📸 **照片配色** - 从照片中选择关键颜色
- 🖼️ **艺术配色** - 从画作中提取特定颜色
- 👔 **服装搭配** - 从服装图片中选择搭配色

---

## 📊 技术实现

### 核心技术
- **PixelMap** - 使用 HarmonyOS 的 PixelMap API
- **像素读取** - readPixelsToBuffer() 读取像素数据
- **坐标转换** - 将点击坐标转换为像素坐标
- **颜色转换** - RGB 转 HEX 格式

### 状态管理
```typescript
@State pickMode: string = 'auto';              // 取色模式
@State manualColors: ColorInfo[] = [];         // 手动颜色
@State currentPixelMap: image.PixelMap | null; // 图片 PixelMap
private maxManualColors: number = 8;           // 最大数量
```

### 关键方法
- `switchPickMode()` - 切换取色模式
- `pickColorAtPosition()` - 点击位置取色
- `removeManualColor()` - 删除颜色
- `clearManualColors()` - 清空颜色
- `rgbToHex()` - RGB 转 HEX

---

## 📁 修改的文件

### `entry/src/main/ets/pages/Index.ets`

**新增导入**：
```typescript
import image from '@ohos.multimedia.image';
```

**新增状态变量**：
- `pickMode` - 取色模式
- `manualColors` - 手动颜色列表
- `currentPixelMap` - 图片 PixelMap
- `maxManualColors` - 最大颜色数量

**新增 UI 组件**：
- `buildPickModeSwitch()` - 模式切换
- `buildManualColorList()` - 手动颜色列表
- `buildManualColorItem()` - 颜色项

**新增方法**：
- `createPixelMap()` - 创建 PixelMap
- `switchPickMode()` - 切换模式
- `pickColorAtPosition()` - 取色
- `rgbToHex()` - 颜色转换
- `removeManualColor()` - 删除颜色
- `clearManualColors()` - 清空颜色

**修改方法**：
- `selectImage()` - 添加创建 PixelMap
- `saveColorScheme()` - 支持手动颜色
- `buildImagePreview()` - 添加点击事件

---

## ✅ 编译结果

```
✅ 0 ERROR
⚠️  42 WARN (可以忽略)
COMPILE RESULT: SUCCESS ✅
```

---

手动取色功能让你完全掌控配色方案，精确提取你想要的颜色！🎨✨

