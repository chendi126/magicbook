// å¯¼å‡ºå·¥å…·ç±»
import { ColorScheme } from '../models/ColorScheme';

export interface ExportFormat {
  type: 'css' | 'json' | 'scss' | 'tailwind' | 'arkts';
  name: string;
  icon: string;
}

// JSON å¯¼å‡ºæ•°æ®æ¥å£
export interface ExportedColorScheme {
  name: string;
  colors: string[];
  tags: string[];
  createTime: number;
  colorCount: number;
}

export const EXPORT_FORMATS: ExportFormat[] = [
  { type: 'arkts', name: 'ArkTS å¸¸é‡', icon: 'ğŸ”·' },
  { type: 'css', name: 'CSS å˜é‡', icon: 'ğŸ¨' },
  { type: 'scss', name: 'SCSS å˜é‡', icon: 'ğŸ’' },
  { type: 'json', name: 'JSON æ•°æ®', icon: 'ğŸ“‹' },
  { type: 'tailwind', name: 'Tailwind é…ç½®', icon: 'ğŸŒŠ' }
];

export class ExportUtils {
  /**
   * å¯¼å‡ºä¸º ArkTS å¸¸é‡æ ¼å¼
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns ArkTS ä»£ç 
   */
  static exportToArkTS(scheme: ColorScheme): string {
    const lines: string[] = [];
    lines.push(`// ${scheme.name}`);
    lines.push('// é…è‰²æ–¹æ¡ˆå¸¸é‡');
    lines.push('');

    // å¯¼å‡ºä¸ºå¸¸é‡æ•°ç»„
    lines.push('export const COLORS = {');
    scheme.colors.forEach((color: string, index: number) => {
      const varName = `COLOR_${index + 1}`;
      const comma = index < scheme.colors.length - 1 ? ',' : '';
      lines.push(`  ${varName}: '${color}'${comma}`);
    });
    lines.push('};');
    lines.push('');

    // å¯¼å‡ºä¸ºæ•°ç»„å½¢å¼
    lines.push('// æˆ–ä½¿ç”¨æ•°ç»„å½¢å¼');
    lines.push('export const COLOR_PALETTE: string[] = [');
    scheme.colors.forEach((color: string, index: number) => {
      const comma = index < scheme.colors.length - 1 ? ',' : '';
      lines.push(`  '${color}'${comma}`);
    });
    lines.push('];');

    return lines.join('\n');
  }

  /**
   * å¯¼å‡ºä¸º CSS å˜é‡æ ¼å¼
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns CSS ä»£ç 
   */
  static exportToCSS(scheme: ColorScheme): string {
    const lines: string[] = [];
    lines.push(`/* ${scheme.name} */`);
    lines.push(':root {');

    scheme.colors.forEach((color: string, index: number) => {
      const varName = `--color-${index + 1}`;
      lines.push(`  ${varName}: ${color};`);
    });

    lines.push('}');
    return lines.join('\n');
  }

  /**
   * å¯¼å‡ºä¸º SCSS å˜é‡æ ¼å¼
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns SCSS ä»£ç 
   */
  static exportToSCSS(scheme: ColorScheme): string {
    const lines: string[] = [];
    lines.push(`// ${scheme.name}`);
    
    scheme.colors.forEach((color: string, index: number) => {
      const varName = `$color-${index + 1}`;
      lines.push(`${varName}: ${color};`);
    });
    
    return lines.join('\n');
  }

  /**
   * å¯¼å‡ºä¸º JSON æ ¼å¼
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns JSON å­—ç¬¦ä¸²
   */
  static exportToJSON(scheme: ColorScheme): string {
    const data: ExportedColorScheme = {
      name: scheme.name,
      colors: scheme.colors,
      tags: scheme.tags ? scheme.tags.split(',') : [],
      createTime: scheme.createTime,
      colorCount: scheme.colors.length
    };
    return JSON.stringify(data, null, 2);
  }

  /**
   * å¯¼å‡ºä¸º Tailwind é…ç½®æ ¼å¼
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns Tailwind é…ç½®ä»£ç 
   */
  static exportToTailwind(scheme: ColorScheme): string {
    const lines: string[] = [];
    lines.push(`// ${scheme.name}`);
    lines.push('module.exports = {');
    lines.push('  theme: {');
    lines.push('    extend: {');
    lines.push('      colors: {');
    
    scheme.colors.forEach((color: string, index: number) => {
      const colorName = `custom-${index + 1}`;
      lines.push(`        '${colorName}': '${color}',`);
    });
    
    lines.push('      }');
    lines.push('    }');
    lines.push('  }');
    lines.push('}');
    return lines.join('\n');
  }

  /**
   * æ ¹æ®æ ¼å¼ç±»å‹å¯¼å‡º
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @param format å¯¼å‡ºæ ¼å¼
   * @returns å¯¼å‡ºçš„ä»£ç å­—ç¬¦ä¸²
   */
  static export(scheme: ColorScheme, format: 'css' | 'json' | 'scss' | 'tailwind' | 'arkts'): string {
    switch (format) {
      case 'arkts':
        return ExportUtils.exportToArkTS(scheme);
      case 'css':
        return ExportUtils.exportToCSS(scheme);
      case 'scss':
        return ExportUtils.exportToSCSS(scheme);
      case 'json':
        return ExportUtils.exportToJSON(scheme);
      case 'tailwind':
        return ExportUtils.exportToTailwind(scheme);
      default:
        return '';
    }
  }

  /**
   * ç”Ÿæˆé…è‰²æ–¹æ¡ˆçš„çº¯æ–‡æœ¬æè¿°
   * @param scheme é…è‰²æ–¹æ¡ˆ
   * @returns çº¯æ–‡æœ¬æè¿°
   */
  static exportToText(scheme: ColorScheme): string {
    const lines: string[] = [];
    lines.push(`é…è‰²æ–¹æ¡ˆï¼š${scheme.name}`);
    lines.push(`é¢œè‰²æ•°é‡ï¼š${scheme.colors.length}`);
    lines.push('');
    lines.push('é¢œè‰²åˆ—è¡¨ï¼š');
    
    scheme.colors.forEach((color: string, index: number) => {
      lines.push(`${index + 1}. ${color}`);
    });
    
    if (scheme.tags && scheme.tags !== '') {
      lines.push('');
      lines.push(`æ ‡ç­¾ï¼š${scheme.tags}`);
    }
    
    return lines.join('\n');
  }

  /**
   * è·å–å¯¼å‡ºæ ¼å¼çš„æ–‡ä»¶æ‰©å±•å
   * @param format å¯¼å‡ºæ ¼å¼
   * @returns æ–‡ä»¶æ‰©å±•å
   */
  static getFileExtension(format: 'css' | 'json' | 'scss' | 'tailwind' | 'arkts' | 'text'): string {
    switch (format) {
      case 'arkts':
        return '.ets';
      case 'css':
        return '.css';
      case 'scss':
        return '.scss';
      case 'json':
        return '.json';
      case 'tailwind':
        return '.js';
      case 'text':
        return '.txt';
      default:
        return '.txt';
    }
  }
}

