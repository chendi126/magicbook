/**
 * ÈÖçËâ≤Â≠¶‰π†‰∏≠ÂøÉ
 * Êèê‰æõÈÖçËâ≤ÁêÜËÆ∫ÊïôÁ®ãÂíåÊ°à‰æãÂàÜÊûê
 */
import { ThemeColors } from '../utils/ThemeColors';
import { ColorScheme } from '../models/ColorScheme';
import { ColorAnalyzer } from '../utils/ColorAnalyzer';
import promptAction from '@ohos.promptAction';

// ÊïôÁ®ãÁ±ªÂûã
interface Tutorial {
  id: string;
  title: string;
  subtitle: string;
  icon: string;
  content: string[];
  examples: string[][];
}

// Ê°à‰æãÁ±ªÂûã
interface ColorCase {
  id: string;
  name: string;
  colors: string[];
  category: string;
  description: string;
  analysis: string;
}

@Component
export struct LearningCenterPage {
  @State currentTab: number = 0; // 0: ÊïôÁ®ã, 1: Ê°à‰æã
  @State selectedTutorial: Tutorial | null = null;
  @State selectedCase: ColorCase | null = null;

  // ÊïôÁ®ãÊï∞ÊçÆ
  private tutorials: Tutorial[] = [
    {
      id: 'color-wheel',
      title: 'Ëâ≤ÂΩ©Âü∫Á°Ä',
      subtitle: '‰∫ÜËß£Ëâ≤ËΩÆ‰∏éËâ≤ÂΩ©ÂÖ≥Á≥ª',
      icon: 'üé®',
      content: [
        'Ëâ≤ËΩÆÊòØÁêÜËß£Ëâ≤ÂΩ©ÂÖ≥Á≥ªÁöÑÂü∫Á°ÄÂ∑•ÂÖ∑ÔºåÁî±12ÁßçÂü∫Êú¨È¢úËâ≤ÁªÑÊàê„ÄÇ',
        '‰∏âÂéüËâ≤ÔºöÁ∫¢„ÄÅÈªÑ„ÄÅËìù - Êó†Ê≥ïÈÄöËøáÂÖ∂‰ªñÈ¢úËâ≤Ê∑∑ÂêàÂæóÂà∞',
        '‰∏âÈó¥Ëâ≤ÔºöÊ©ô„ÄÅÁªø„ÄÅÁ¥´ - Áî±‰∏§ÁßçÂéüËâ≤Ê∑∑ÂêàËÄåÊàê',
        'ÂÖ≠Â§çËâ≤ÔºöÁî±ÂéüËâ≤ÂíåÈó¥Ëâ≤Ê∑∑ÂêàËÄåÊàê',
        'ÁêÜËß£Ëâ≤ËΩÆÂèØ‰ª•Â∏ÆÂä©‰Ω†ÂàõÂª∫ÂíåË∞êÁöÑÈÖçËâ≤ÊñπÊ°à„ÄÇ'
      ],
      examples: [
        ['#FF0000', '#FFFF00', '#0000FF'], // ‰∏âÂéüËâ≤
        ['#FF8800', '#00FF00', '#8800FF']  // ‰∏âÈó¥Ëâ≤
      ]
    },
    {
      id: 'complementary',
      title: '‰∫íË°•Ëâ≤ÈÖçËâ≤',
      subtitle: 'ÂØπÊØîÂº∫ÁÉàÁöÑÈÖçËâ≤ÊñπÊ°à',
      icon: '‚ö°',
      content: [
        '‰∫íË°•Ëâ≤ÊòØËâ≤ËΩÆ‰∏äÁõ∏ÂØπÁöÑ‰∏§ÁßçÈ¢úËâ≤ÔºåÂ¶ÇÁ∫¢‰∏éÁªø„ÄÅËìù‰∏éÊ©ô„ÄÇ',
        '‰∫íË°•Ëâ≤Êê≠ÈÖç‰∫ßÁîüÂº∫ÁÉàÁöÑËßÜËßâÂØπÊØîÔºåÂÖÖÊª°Ê¥ªÂäõÂíåÂº†Âäõ„ÄÇ',
        'ÈÄÇÁî®Âú∫ÊôØÔºöÈúÄË¶ÅÂê∏ÂºïÊ≥®ÊÑèÂäõÁöÑËÆæËÆ°ÔºåÂ¶ÇÂπøÂëä„ÄÅÊµ∑Êä•„ÄÇ',
        '‰ΩøÁî®ÊäÄÂ∑ßÔºö‰∏ÄÁßçÈ¢úËâ≤‰Ωú‰∏∫‰∏ªËâ≤ÔºåÂè¶‰∏ÄÁßç‰Ωú‰∏∫Âº∫Ë∞ÉËâ≤„ÄÇ',
        'Ê≥®ÊÑèÔºöÈÅøÂÖçÁ≠âÈáè‰ΩøÁî®Ôºå‰ºö‰∫ßÁîüËßÜËßâÁñ≤Âä≥„ÄÇ'
      ],
      examples: [
        ['#FF0000', '#00FF00'], // Á∫¢Áªø
        ['#0000FF', '#FFA500'], // ËìùÊ©ô
        ['#FFFF00', '#8800FF']  // ÈªÑÁ¥´
      ]
    },
    {
      id: 'analogous',
      title: 'Á±ª‰ººËâ≤ÈÖçËâ≤',
      subtitle: 'ÂíåË∞êÁªü‰∏ÄÁöÑÈÖçËâ≤ÊñπÊ°à',
      icon: 'üåà',
      content: [
        'Á±ª‰ººËâ≤ÊòØËâ≤ËΩÆ‰∏äÁõ∏ÈÇªÁöÑÈ¢úËâ≤ÔºåÈÄöÂ∏∏ÂåÖÂê´3-5ÁßçÈ¢úËâ≤„ÄÇ',
        'Á±ª‰ººËâ≤Êê≠ÈÖçÂíåË∞êÁªü‰∏ÄÔºåÁªô‰∫∫ËàíÈÄÇ„ÄÅËá™ÁÑ∂ÁöÑÊÑüËßâ„ÄÇ',
        'ÈÄÇÁî®Âú∫ÊôØÔºöÈúÄË¶ÅËê•ÈÄ†Ê∏©È¶®„ÄÅÂπ≥ÂíåÊ∞õÂõ¥ÁöÑËÆæËÆ°„ÄÇ',
        '‰ΩøÁî®ÊäÄÂ∑ßÔºöÈÄâÊã©‰∏ÄÁßç‰∏ªËâ≤ÔºåÂÖ∂‰ªñÈ¢úËâ≤‰Ωú‰∏∫ËæÖÂä©„ÄÇ',
        'Â∏∏ËßÅÁªÑÂêàÔºöËìù-ËìùÁªø-Áªø„ÄÅÁ∫¢-Ê©ô-ÈªÑÁ≠â„ÄÇ'
      ],
      examples: [
        ['#0066CC', '#0099CC', '#00CCCC'], // ËìùËâ≤Á≥ª
        ['#FF6600', '#FF9900', '#FFCC00'], // Ê©ôÈªÑÁ≥ª
        ['#CC0066', '#FF0066', '#FF3399']  // Á∫¢Á≤âÁ≥ª
      ]
    },
    {
      id: 'triadic',
      title: '‰∏âËßíÈÖçËâ≤',
      subtitle: 'Âπ≥Ë°°Ê¥ªÊ≥ºÁöÑÈÖçËâ≤ÊñπÊ°à',
      icon: '‚ñ≥',
      content: [
        '‰∏âËßíÈÖçËâ≤‰ΩøÁî®Ëâ≤ËΩÆ‰∏äÁ≠âË∑ùÁöÑ‰∏âÁßçÈ¢úËâ≤„ÄÇ',
        'ËøôÁßçÈÖçËâ≤Êó¢ÊúâÂØπÊØîÂèà‰øùÊåÅÂπ≥Ë°°ÔºåÂÖÖÊª°Ê¥ªÂäõ‰ΩÜ‰∏çÂ§±ÂíåË∞ê„ÄÇ',
        'ÈÄÇÁî®Âú∫ÊôØÔºöÈúÄË¶Å‰∏∞ÂØåËâ≤ÂΩ©‰ΩÜ‰øùÊåÅÂπ≥Ë°°ÁöÑËÆæËÆ°„ÄÇ',
        '‰ΩøÁî®ÊäÄÂ∑ßÔºöÈÄâÊã©‰∏ÄÁßç‰∏ªËâ≤ÔºåÂÖ∂‰ªñ‰∏§Áßç‰Ωú‰∏∫ËæÖÂä©Ëâ≤„ÄÇ',
        'ÁªèÂÖ∏ÁªÑÂêàÔºöÁ∫¢-ÈªÑ-Ëìù„ÄÅÊ©ô-Áªø-Á¥´Á≠â„ÄÇ'
      ],
      examples: [
        ['#FF0000', '#FFFF00', '#0000FF'], // Á∫¢ÈªÑËìù
        ['#FF8800', '#00FF00', '#8800FF'], // Ê©ôÁªøÁ¥´
        ['#FF0066', '#00FF66', '#6600FF']  // Á≤âÁªøÁ¥´
      ]
    },
    {
      id: 'monochromatic',
      title: 'ÂçïËâ≤ÈÖçËâ≤',
      subtitle: '‰ºòÈõÖÁÆÄÁ∫¶ÁöÑÈÖçËâ≤ÊñπÊ°à',
      icon: '‚óâ',
      content: [
        'ÂçïËâ≤ÈÖçËâ≤‰ΩøÁî®Âêå‰∏ÄËâ≤Áõ∏ÁöÑ‰∏çÂêåÊòéÂ∫¶ÂíåÈ•±ÂíåÂ∫¶„ÄÇ',
        'ËøôÁßçÈÖçËâ≤ÁÆÄÊ¥Å‰ºòÈõÖÔºåÂÆπÊòìËê•ÈÄ†Áªü‰∏ÄÁöÑËßÜËßâÊïàÊûú„ÄÇ',
        'ÈÄÇÁî®Âú∫ÊôØÔºöÈúÄË¶Å‰∏ì‰∏ö„ÄÅÁÆÄÁ∫¶È£éÊ†ºÁöÑËÆæËÆ°„ÄÇ',
        '‰ΩøÁî®ÊäÄÂ∑ßÔºöÈÄöËøáÊòéÊöóÂØπÊØîÂàõÈÄ†Â±ÇÊ¨°ÊÑü„ÄÇ',
        'Ê≥®ÊÑèÔºöÈÅøÂÖçËøá‰∫éÂçïË∞ÉÔºåÈÄÇÂΩìÂ¢ûÂä†ÂØπÊØîÂ∫¶„ÄÇ'
      ],
      examples: [
        ['#003366', '#0066CC', '#3399FF', '#99CCFF'], // ËìùËâ≤ÂçïËâ≤
        ['#660033', '#CC0066', '#FF3399', '#FFCCDD'], // Á≤âËâ≤ÂçïËâ≤
        ['#336600', '#66CC00', '#99FF33', '#CCFF99']  // ÁªøËâ≤ÂçïËâ≤
      ]
    },
    {
      id: 'tetradic',
      title: 'ÂõõËßíÈÖçËâ≤',
      subtitle: '‰∏∞ÂØåÂ§öÂΩ©ÁöÑÈÖçËâ≤ÊñπÊ°à',
      icon: '‚óá',
      content: [
        'ÂõõËßíÈÖçËâ≤‰ΩøÁî®Ëâ≤ËΩÆ‰∏äÂΩ¢ÊàêÁü©ÂΩ¢ÁöÑÂõõÁßçÈ¢úËâ≤„ÄÇ',
        'ËøôÁßçÈÖçËâ≤ÊúÄ‰∏∫‰∏∞ÂØåÔºå‰ΩÜ‰πüÊúÄÈöæÊéåÊè°Âπ≥Ë°°„ÄÇ',
        'ÈÄÇÁî®Âú∫ÊôØÔºöÈúÄË¶Å‰∏∞ÂØåËâ≤ÂΩ©ÁöÑÂàõÊÑèËÆæËÆ°„ÄÇ',
        '‰ΩøÁî®ÊäÄÂ∑ßÔºöÈÄâÊã©‰∏ÄÁßç‰∏ªËâ≤ÔºåÂÖ∂‰ªñÈ¢úËâ≤‰Ωú‰∏∫ÁÇπÁºÄ„ÄÇ',
        'Ê≥®ÊÑèÔºöÈÅøÂÖçÊâÄÊúâÈ¢úËâ≤Á≠âÈáè‰ΩøÁî®Ôºå‰øùÊåÅ‰∏ªÊ¨°ÂÖ≥Á≥ª„ÄÇ'
      ],
      examples: [
        ['#FF0000', '#FFAA00', '#00FF00', '#0055FF'], // Á∫¢Ê©ôÁªøËìù
        ['#FF0066', '#FFCC00', '#00FF99', '#6600FF']  // Á≤âÈªÑÈùíÁ¥´
      ]
    }
  ];

  // Ê°à‰æãÊï∞ÊçÆ
  private cases: ColorCase[] = [
    {
      id: 'case-1',
      name: 'ÁßëÊäÄËìù',
      colors: ['#0066FF', '#00AAFF', '#FFFFFF', '#F5F5F5'],
      category: '‰ºÅ‰∏öÂìÅÁâå',
      description: '‰∏ì‰∏ö„ÄÅÂèØÈù†„ÄÅÂàõÊñ∞ÁöÑÁßëÊäÄÂÖ¨Âè∏ÈÖçËâ≤',
      analysis: '‰ª•ËìùËâ≤‰∏∫‰∏ªËâ≤Ë∞ÉÔºå‰º†Ëææ‰∏ì‰∏öÂíå‰ø°‰ªªÊÑü„ÄÇÁôΩËâ≤ÂíåÊµÖÁÅ∞Ëâ≤‰Ωú‰∏∫ËæÖÂä©Ëâ≤ÔºåËê•ÈÄ†ÁÆÄÊ¥ÅÁé∞‰ª£ÁöÑËßÜËßâÊïàÊûú„ÄÇ'
    },
    {
      id: 'case-2',
      name: 'Ê¥ªÂäõÊ©ô',
      colors: ['#FF6600', '#FF9933', '#FFCC00', '#FFFFFF'],
      category: 'ËøêÂä®ÂÅ•Ë∫´',
      description: 'ÂÖÖÊª°Ê¥ªÂäõÂíåÊøÄÊÉÖÁöÑËøêÂä®ÂìÅÁâåÈÖçËâ≤',
      analysis: 'Ê©ôËâ≤Á≥ª‰º†ËææÊ¥ªÂäõÂíåÁÉ≠ÊÉÖÔºåÊ∏êÂèòÁöÑÊ©ôÈªÑËâ≤Â¢ûÂä†Â±ÇÊ¨°ÊÑüÔºåÁôΩËâ≤Êèê‰æõËßÜËßâÂëºÂê∏Á©∫Èó¥„ÄÇ'
    },
    {
      id: 'case-3',
      name: 'Ëá™ÁÑ∂Áªø',
      colors: ['#2E7D32', '#66BB6A', '#A5D6A7', '#E8F5E9'],
      category: 'ÁéØ‰øùÂÅ•Â∫∑',
      description: 'Ê∏ÖÊñ∞Ëá™ÁÑ∂ÁöÑÁéØ‰øùÂìÅÁâåÈÖçËâ≤',
      analysis: 'ÁªøËâ≤Á≥ª‰º†ËææËá™ÁÑ∂ÂíåÂÅ•Â∫∑Ôºå‰ªéÊ∑±Âà∞ÊµÖÁöÑÊ∏êÂèòËê•ÈÄ†ËàíÈÄÇÁöÑËßÜËßâ‰ΩìÈ™å„ÄÇ'
    }
  ];

  build() {
    Column() {
      // Ê†áÈ¢òÊ†è
      this.buildHeader();

      // ‰ΩøÁî® Tabs ÁªÑ‰ª∂
      Tabs({ barPosition: BarPosition.Start, index: this.currentTab }) {
        TabContent() {
          this.buildTutorialContent();
        }
        .tabBar(this.buildTabBarItem('ÁêÜËÆ∫ÊïôÁ®ã', 0))

        TabContent() {
          this.buildCaseContent();
        }
        .tabBar(this.buildTabBarItem('Ê°à‰æãÂàÜÊûê', 1))
      }
      .barMode(BarMode.Fixed)
      .barWidth('100%')
      .barHeight(56)
      .animationDuration(300)
      .onChange((index: number) => {
        this.currentTab = index;
      })
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.backgroundSecondary)
  }

  // Ê†áÈ¢òÊ†è
  @Builder
  buildHeader() {
    Column() {
      Text('ÈÖçËâ≤Â≠¶‰π†‰∏≠ÂøÉ')
        .fontSize(28)
        .fontWeight(FontWeight.Bold)
        .fontColor(ThemeColors.textPrimary)
        .margin({ bottom: 4 })

      Text('ÊéåÊè°ÈÖçËâ≤ÁêÜËÆ∫ÔºåÊèêÂçáËÆæËÆ°ËÉΩÂäõ')
        .fontSize(14)
        .fontColor(ThemeColors.textTertiary)
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
    .padding({ left: 20, right: 20, top: 20, bottom: 10 })
    .backgroundColor(ThemeColors.background)
  }

  // TabBar È°π
  @Builder
  buildTabBarItem(title: string, index: number) {
    Column() {
      Text(title)
        .fontSize(16)
        .fontWeight(this.currentTab === index ? FontWeight.Bold : FontWeight.Medium)
        .fontColor(this.currentTab === index ? ThemeColors.primary : ThemeColors.textSecondary)
        .animation({ duration: 300 })
      
      // ÊåáÁ§∫Âô®
      if (this.currentTab === index) {
        Row()
          .width(20)
          .height(3)
          .backgroundColor(ThemeColors.primary)
          .borderRadius(1.5)
          .margin({ top: 4 })
          .transition({ type: TransitionType.Insert, opacity: 0, scale: { x: 0.5 } })
      }
    }
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }

  // ÊïôÁ®ãÂÜÖÂÆπ
  @Builder
  buildTutorialContent() {
    Stack() {
      if (this.selectedTutorial) {
        this.buildTutorialDetail();
      } else {
        this.buildTutorialList();
      }
    }
    .width('100%')
    .height('100%')
  }

  // ÊïôÁ®ãÂàóË°®
  @Builder
  buildTutorialList() {
    List({ space: 16 }) {
      ForEach(this.tutorials, (tutorial: Tutorial) => {
        ListItem() {
          this.buildTutorialCard(tutorial);
        }
      })
    }
    .width('100%')
    .height('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 80 })
    .scrollBar(BarState.Auto)
    .edgeEffect(EdgeEffect.Spring)
  }

  // ÊïôÁ®ãÂç°Áâá
  @Builder
  buildTutorialCard(tutorial: Tutorial) {
    Row() {
      // ÂõæÊ†á
      Column() {
        Text(tutorial.icon)
          .fontSize(32)
      }
      .width(60)
      .height(60)
      .justifyContent(FlexAlign.Center)
      .alignItems(HorizontalAlign.Center)
      .backgroundColor(ThemeColors.background)
      .borderRadius(16)
      .margin({ right: 16 })

      // ÂÜÖÂÆπ
      Column({ space: 4 }) {
        Text(tutorial.title)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor(ThemeColors.textPrimary)

        Text(tutorial.subtitle)
          .fontSize(14)
          .fontColor(ThemeColors.textTertiary)
          .maxLines(1)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)

      // ÁÆ≠Â§¥
      Image($r('app.media.ic_public_arrow_right'))
        .width(20)
        .height(20)
        .fillColor(ThemeColors.textPlaceholder)
    }
    .width('100%')
    .padding(16)
    .backgroundColor(ThemeColors.backgroundCard)
    .borderRadius(20)
    .shadow({
      radius: 12,
      color: 'rgba(0, 0, 0, 0.05)',
      offsetY: 4
    })
    .onClick(() => {
      animateTo({ duration: 300, curve: Curve.EaseInOut }, () => {
        this.selectedTutorial = tutorial;
      })
    })
  }

  // ÊïôÁ®ãËØ¶ÊÉÖ
  @Builder
  buildTutorialDetail() {
    Column() {
      // ÂØºËà™Ê†è
      Row() {
        Image($r('app.media.ic_public_back'))
          .width(24)
          .height(24)
          .fillColor(ThemeColors.textPrimary)
          .onClick(() => {
            animateTo({ duration: 300, curve: Curve.EaseInOut }, () => {
              this.selectedTutorial = null;
            })
          })
        
        Text(this.selectedTutorial?.title)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor(ThemeColors.textPrimary)
          .margin({ left: 16 })
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 12, bottom: 12 })
      .backgroundColor(ThemeColors.background)

      Scroll() {
        Column() {
          if (this.selectedTutorial) {
            // Â§¥ÈÉ®Âç°Áâá
            Column() {
              Text(this.selectedTutorial.icon)
                .fontSize(48)
                .margin({ bottom: 16 })

              Text(this.selectedTutorial.title)
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(ThemeColors.textPrimary)
                .margin({ bottom: 8 })

              Text(this.selectedTutorial.subtitle)
                .fontSize(16)
                .fontColor(ThemeColors.textTertiary)
            }
            .width('100%')
            .alignItems(HorizontalAlign.Center)
            .padding(32)
            .backgroundColor(ThemeColors.backgroundCard)
            .borderRadius(24)
            .margin({ bottom: 24 })

            // ÁêÜËÆ∫Áü•ËØÜ
            Column() {
              Text('ÁêÜËÆ∫Áü•ËØÜ')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor(ThemeColors.textPrimary)
                .margin({ bottom: 16 })

              ForEach(this.selectedTutorial.content, (paragraph: string, index: number) => {
                Row() {
                  Text((index + 1).toString())
                    .fontSize(14)
                    .fontWeight(FontWeight.Bold)
                    .fontColor(ThemeColors.primary)
                    .width(24)
                    .height(24)
                    .textAlign(TextAlign.Center)
                    .backgroundColor(ThemeColors.primaryLight)
                    .borderRadius(12)
                    .margin({ right: 12, top: 2 })

                  Text(paragraph)
                    .fontSize(15)
                    .fontColor(ThemeColors.textSecondary)
                    .lineHeight(24)
                    .layoutWeight(1)
                }
                .alignItems(VerticalAlign.Top)
                .margin({ bottom: 16 })
              })
            }
            .width('100%')
            .padding(24)
            .backgroundColor(ThemeColors.backgroundCard)
            .borderRadius(24)
            .margin({ bottom: 24 })

            // ÈÖçËâ≤Á§∫‰æã
            Column() {
              Text('ÈÖçËâ≤Á§∫‰æã')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor(ThemeColors.textPrimary)
                .margin({ bottom: 16 })

              ForEach(this.selectedTutorial.examples, (colors: string[], index: number) => {
                Column() {
                  Row() {
                    ForEach(colors, (color: string) => {
                      Column()
                        .backgroundColor(color)
                        .layoutWeight(1)
                        .height(60)
                    })
                  }
                  .width('100%')
                  .borderRadius(12)
                  .clip(true)
                  .shadow({
                    radius: 8,
                    color: 'rgba(0,0,0,0.1)',
                    offsetY: 4
                  })

                  Row({ space: 8 }) {
                    ForEach(colors, (color: string) => {
                      Text(color)
                        .fontSize(12)
                        .fontColor(ThemeColors.textPlaceholder)
                        .fontFamily('monospace')
                        .layoutWeight(1)
                        .textAlign(TextAlign.Center)
                    })
                  }
                  .width('100%')
                  .margin({ top: 8 })
                }
                .width('100%')
                .margin({ bottom: 20 })
              })
            }
            .width('100%')
            .padding(24)
            .backgroundColor(ThemeColors.backgroundCard)
            .borderRadius(24)
          }
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 20, bottom: 80 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.backgroundSecondary)
    .transition({ type: TransitionType.Insert, translate: { x: '100%' } })
  }

  // Ê°à‰æãÂÜÖÂÆπ
  @Builder
  buildCaseContent() {
    Stack() {
      if (this.selectedCase) {
        this.buildCaseDetail();
      } else {
        this.buildCaseList();
      }
    }
    .width('100%')
    .height('100%')
  }

  // Ê°à‰æãÂàóË°®
  @Builder
  buildCaseList() {
    List({ space: 20 }) {
      // ÂàÜÁªÑÊòæÁ§∫
      ListItem() {
        this.buildCaseCategory('‰ºÅ‰∏öÂìÅÁâå');
      }
      ListItem() {
        this.buildCaseCategory('ËøêÂä®ÂÅ•Ë∫´');
      }
      ListItem() {
        this.buildCaseCategory('ÁéØ‰øùÂÅ•Â∫∑');
      }
    }
    .width('100%')
    .height('100%')
    .padding({ left: 20, right: 20, top: 16, bottom: 80 })
    .scrollBar(BarState.Auto)
    .edgeEffect(EdgeEffect.Spring)
  }

  // Ê°à‰æãÂàÜÁ±ª
  @Builder
  buildCaseCategory(category: string) {
    Column() {
      Text(category)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor(ThemeColors.textPrimary)
        .margin({ bottom: 12 })

      List({ space: 12 }) {
        ForEach(this.cases.filter(c => c.category === category), (colorCase: ColorCase) => {
          ListItem() {
            this.buildCaseCard(colorCase);
          }
        })
      }
      .width('100%')
    }
    .width('100%')
  }

  // Ê°à‰æãÂç°Áâá
  @Builder
  buildCaseCard(colorCase: ColorCase) {
    Column() {
      // ÈÖçËâ≤È¢ÑËßà
      Row() {
        ForEach(colorCase.colors, (color: string) => {
          Column()
            .backgroundColor(color)
            .layoutWeight(1)
            .height(100)
        })
      }
      .width('100%')
      .borderRadius({ topLeft: 16, topRight: 16 })
      .clip(true)

      // ‰ø°ÊÅØ
      Column() {
        Row() {
          Text(colorCase.name)
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor(ThemeColors.textPrimary)
            .layoutWeight(1)

          Text(colorCase.category)
            .fontSize(12)
            .fontColor(ThemeColors.primary)
            .backgroundColor(ThemeColors.primaryLight)
            .padding({ left: 10, right: 10, top: 4, bottom: 4 })
            .borderRadius(100)
        }
        .width('100%')
        .margin({ bottom: 8 })

        Text(colorCase.description)
          .fontSize(14)
          .fontColor(ThemeColors.textSecondary)
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
      }
      .width('100%')
      .padding(16)
    }
    .width('100%')
    .backgroundColor(ThemeColors.backgroundCard)
    .borderRadius(16)
    .shadow({
      radius: 12,
      color: 'rgba(0, 0, 0, 0.05)',
      offsetY: 4
    })
    .onClick(() => {
      animateTo({ duration: 300, curve: Curve.EaseInOut }, () => {
        this.selectedCase = colorCase;
      })
    })
  }

  // Ê°à‰æãËØ¶ÊÉÖ
  @Builder
  buildCaseDetail() {
    Column() {
      // ÂØºËà™Ê†è
      Row() {
        Image($r('app.media.ic_public_back'))
          .width(24)
          .height(24)
          .fillColor(ThemeColors.textPrimary)
          .onClick(() => {
            animateTo({ duration: 300, curve: Curve.EaseInOut }, () => {
              this.selectedCase = null;
            })
          })
        
        Text(this.selectedCase?.name)
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor(ThemeColors.textPrimary)
          .margin({ left: 16 })
      }
      .width('100%')
      .padding({ left: 20, right: 20, top: 12, bottom: 12 })
      .backgroundColor(ThemeColors.background)

      Scroll() {
        Column() {
          if (this.selectedCase) {
            // ÈÖçËâ≤È¢ÑËßàÂ§ßÂõæ
            Column() {
              Row() {
                ForEach(this.selectedCase.colors, (color: string) => {
                  Column()
                    .backgroundColor(color)
                    .layoutWeight(1)
                    .height(160)
                })
              }
              .width('100%')
              .borderRadius(24)
              .clip(true)
              .shadow({
                radius: 20,
                color: 'rgba(0,0,0,0.15)',
                offsetY: 8
              })

              // È¢úËâ≤ÂÄº
              Row({ space: 12 }) {
                ForEach(this.selectedCase.colors, (color: string) => {
                  Column({ space: 6 }) {
                    Circle({ width: 24, height: 24 })
                      .fill(color)
                      .stroke(ThemeColors.border)
                      .strokeWidth(1)

                    Text(color)
                      .fontSize(12)
                      .fontColor(ThemeColors.textSecondary)
                      .fontFamily('monospace')
                  }
                  .layoutWeight(1)
                })
              }
              .width('100%')
              .margin({ top: 24 })
              .padding(16)
              .backgroundColor(ThemeColors.backgroundCard)
              .borderRadius(16)
            }
            .width('100%')
            .margin({ bottom: 24 })

            // Ê°à‰æã‰ø°ÊÅØ
            Column() {
              Text('ËÆæËÆ°ÁêÜÂøµ')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor(ThemeColors.textPrimary)
                .margin({ bottom: 12 })

              Text(this.selectedCase.description)
                .fontSize(15)
                .fontColor(ThemeColors.textSecondary)
                .lineHeight(24)
                .margin({ bottom: 24 })

              Text('‰∏ì‰∏öÂàÜÊûê')
                .fontSize(18)
                .fontWeight(FontWeight.Bold)
                .fontColor(ThemeColors.textPrimary)
                .margin({ bottom: 12 })

              Text(this.selectedCase.analysis)
                .fontSize(15)
                .fontColor(ThemeColors.textSecondary)
                .lineHeight(24)
            }
            .width('100%')
            .padding(24)
            .backgroundColor(ThemeColors.backgroundCard)
            .borderRadius(24)
          }
        }
        .width('100%')
        .padding({ left: 20, right: 20, top: 20, bottom: 80 })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(ThemeColors.backgroundSecondary)
    .transition({ type: TransitionType.Insert, translate: { x: '100%' } })
  }
}
